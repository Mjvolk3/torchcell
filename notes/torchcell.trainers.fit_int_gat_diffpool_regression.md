---
id: 3xes28t6tmsfck7mbvusptq
title: Fit_int_gat_diffpool_regression
desc: ''
updated: 1728635538597
created: 1728635402081
---
Generated by Claude from model files

## GatDiffPool Model Algorithm

**Input:** Graph $G = (V, E)$, feature matrix $\mathbf{X} \in \mathbb{R}^{|V| \times F}$, adjacency matrix $\mathbf{A} \in \mathbb{R}^{|V| \times |V|}$  
**Output:** Predicted output $\mathbf{y} \in \mathbb{R}^{2}$ (fitness and gene interaction scores)

1. **Initial GAT Layers:**
   For $l = 1$ to $L_{GAT}$:
   - $\mathbf{H}^{(l)} = \text{GATv2}(\mathbf{H}^{(l-1)}, \mathbf{A})$, where $\mathbf{H}^{(0)} = \mathbf{X}$
   - $\mathbf{H}^{(l)} = \text{Norm}(\mathbf{H}^{(l)})$
   - $\mathbf{H}^{(l)} = \text{ReLU}(\mathbf{H}^{(l)})$
   - If skip connection: $\mathbf{H}^{(l)} = \mathbf{H}^{(l)} + \mathbf{H}^{(l-1)}$

2. **DiffPool Layers:**
   For $k = 1$ to $L_{DiffPool}$:
   - $\mathbf{S}^{(k)} = \text{MLP}(\mathbf{H}^{(k-1)})$
   - $\mathbf{H}^{(k)}, \mathbf{A}^{(k)} = \text{DiffPool}(\mathbf{H}^{(k-1)}, \mathbf{A}^{(k-1)}, \mathbf{S}^{(k)})$

   - If edge pruning enabled:
     - $\mathbf{A}^{(k)} = \text{PruneEdges}(\mathbf{A}^{(k)}, k_{max})$

   - **Post-pooling GAT Layers:**
     For $m = 1$ to $L_{PostGAT}$:
     - $\mathbf{H}^{(k,m)} = \text{GATv2}(\mathbf{H}^{(k,m-1)}, \mathbf{A}^{(k)})$
     - $\mathbf{H}^{(k,m)} = \text{Norm}(\mathbf{H}^{(k,m)})$
     - $\mathbf{H}^{(k,m)} = \text{ReLU}(\mathbf{H}^{(k,m)})$
     - If skip connection: $\mathbf{H}^{(k,m)} = \mathbf{H}^{(k,m)} + \mathbf{H}^{(k,m-1)}$

3. **Final Linear Layer:**
   $\mathbf{y} = \text{Linear}(\mathbf{H}^{(L_{DiffPool})})$

4. **Loss Calculation:**
   - $\mathcal{L}_{MSE} = \text{CombinedMSELoss}(\mathbf{y}, \mathbf{y}_{true})$
   - $\mathcal{L}_{LinkPred} = \sum_{k=1}^{L_{DiffPool}} \text{LinkPredictionLoss}^{(k)}$
   - $\mathcal{L}_{Entropy} = \sum_{k=1}^{L_{DiffPool}} \text{EntropyLoss}^{(k)}$
   - $\mathcal{L}_{Total} = \mathcal{L}_{MSE} + \lambda_{LinkPred} \mathcal{L}_{LinkPred} + \lambda_{Entropy} \mathcal{L}_{Entropy}$

**Model Details:**

- $L_{GAT}$: Number of initial GAT layers
- $L_{DiffPool}$: Number of DiffPool layers
- $L_{PostGAT}$: Number of post-pooling GAT layers
- $k_{max}$: Maximum average node degree for edge pruning
- $\lambda_{LinkPred}$, $\lambda_{Entropy}$: Loss weighting factors

**Loss Function:**

$$
\begin{aligned}
\mathcal{L}_{Total} &= \mathcal{L}_{MSE} + \lambda_{LinkPred} \mathcal{L}_{LinkPred} + \lambda_{Entropy} \mathcal{L}_{Entropy} \\
\mathcal{L}_{MSE} &= \frac{1}{2} \sum_{i=1}^{2} w_i \cdot \text{MSE}(\mathbf{y}_i, \mathbf{y}_{true,i}) \\
\mathcal{L}_{LinkPred} &= \sum_{k=1}^{L_{DiffPool}} \text{LinkPredictionLoss}^{(k)} \\
\mathcal{L}_{Entropy} &= \sum_{k=1}^{L_{DiffPool}} \text{EntropyLoss}^{(k)}
\end{aligned}
$$

where $w_i$ are the weights for each output dimension (fitness and gene interaction), and $\text{MSE}$ is the Mean Squared Error function that ignores NaN values.
